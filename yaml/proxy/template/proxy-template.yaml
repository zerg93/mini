- route-template:
    id: proxy-template
    parameters:
      - name: RequestTopic
      - name: ResponseTopic
    from:
      uri: vertx-kafka:{{RequestTopic}}
      steps:
        - onCompletion:
            steps:
              - setHeader:
                  name: kafka_correlationId
                  simple: ${exchangeProperty.kafka_correlationId}
              - log: "ì‘ë‹µ í—¤ë”: ${headers}"
              - to: vertx-kafka:{{ResponseTopic}}
        - onException:
            exception: java.lang.Exception
            handled:
              constant: true
            steps:
              - log: "ğŸ”¥ ì˜ˆì™¸ ë°œìƒ: ${exception.message}"
              - stop: {}

        - threads:
            poolSize: 10
            maxPoolSize: 50
            maxQueueSize: 1000
        - setProperty:
            name: kafka_correlationId
            simple: ${header.kafka_correlationId}
        - setProperty:
            name: kafka.PARTITION
            simple: ${header.kafka.PARTITION}
        - log: "ìˆ˜ì‹  í—¤ë”: ${headers}"
        - removeHeaders:
            pattern: CamelHttp*

        - load-balance:
            round-robin: {}
            steps:
              - to: "http://localhost:9083/prov/I0000004/getTrain/getTrainInfo?bridgeEndpoint=true"

        - log: "ì‘ë‹µ ë°”ë””: ${body}"

        - removeHeaders:    # âœ… ì¤‘ë³µ í—¤ë” ë°©ì§€
            pattern: "*"
